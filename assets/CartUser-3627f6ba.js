import{M as C}from"./modal-53d2ba02.js";import{_ as g,o as d,c,a as t,j as k,F as b,e as $,t as i,g as u,h as p,r as _,b as f,f as x,w}from"./index-d08e83de.js";import"./component-functions-81ebb201.js";const M={name:"checkModal",props:["order"],data(){return{modal:{},form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{showModal(){this.modal.show()},hideModal(){this.modal.hide()},createOrder(){const e="https://vue3-course-api.hexschool.io/api/roger8426-api/order",o=this.form;this.$http.post(e,{data:o}).then(n=>{n.data.success&&(this.$router.push(`/user/order/${n.data.orderId}`),this.hideModal())})}},mounted(){this.modal=new C(this.$refs.modal)}},L={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},V={class:"modal-dialog",role:"document"},U={class:"modal-content"},q=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},"訂單列表"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),j={class:"modal-body pb-0"},N={class:"row justify-content-center"},P={class:"table align-middle"},B=t("thead",null,[t("th",{class:"ps-2"},"品名"),t("th",null,"數量"),t("th",{class:"text-end pe-2"},"單價")],-1),E={class:"text-end"},O=t("td",{colspan:"2",class:"text-end"},"總計",-1),T={class:"text-end"},D={class:"mb-3"},F=t("label",{for:"email",class:"form-label"},"Email",-1),S={class:"mb-3"},I=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),z={class:"mb-3"},A=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),G={class:"mb-3"},H=t("label",{for:"address",class:"form-label"},"收件人地址",-1),J={class:"mb-3"},K=t("label",{for:"message",class:"form-label"},"留言",-1),Q=t("div",{class:"modal-footer border-top-0 pt-0"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消"),t("button",{class:"btn btn-primary"},"送出訂單")],-1);function R(e,o,n,m,s,r){return d(),c("div",L,[t("div",V,[t("div",U,[q,t("div",j,[t("div",N,[t("form",{class:"col",onSubmit:o[5]||(o[5]=k((...l)=>r.createOrder&&r.createOrder(...l),["prevent"]))},[t("table",P,[B,t("tbody",null,[(d(!0),c(b,null,$(n.order.carts,l=>(d(),c("tr",{key:l.id},[t("td",null,i(l.product.title),1),t("td",null,i(`${l.qty} / ${l.product.unit}`),1),t("td",E,i(e.$filters.currency(l.product.price)),1)]))),128))]),t("tfoot",null,[t("tr",null,[O,t("td",T,i(e.$filters.currency(n.order.final_total)),1)])])]),t("div",D,[F,u(t("input",{id:"email",name:"email",type:"email",class:"form-control",placeholder:"請輸入 Email","onUpdate:modelValue":o[0]||(o[0]=l=>s.form.user.email=l)},null,512),[[p,s.form.user.email]])]),t("div",S,[I,u(t("input",{id:"name",name:"姓名",type:"text",class:"form-control",placeholder:"請輸入姓名","onUpdate:modelValue":o[1]||(o[1]=l=>s.form.user.name=l)},null,512),[[p,s.form.user.name]])]),t("div",z,[A,u(t("input",{id:"tel",name:"電話",type:"tel",class:"form-control",placeholder:"請輸入電話","onUpdate:modelValue":o[2]||(o[2]=l=>s.form.user.tel=l)},null,512),[[p,s.form.user.tel]])]),t("div",G,[H,u(t("input",{id:"address",name:"地址",type:"text",class:"form-control",placeholder:"請輸入地址","onUpdate:modelValue":o[3]||(o[3]=l=>s.form.user.address=l)},null,512),[[p,s.form.user.address]])]),t("div",J,[K,u(t("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":o[4]||(o[4]=l=>s.form.message=l)},null,512),[[p,s.form.message]])]),Q],32)])])])])],512)}const W=g(M,[["render",R]]),X={data(){return{cart:{},total:0,finalTotal:0,tempProduct:{},isLoading:!1,numLoading:!1,couponCode:""}},components:{CheckModal:W},methods:{getCart(){const e="https://vue3-course-api.hexschool.io/api/roger8426-api/cart";this.isLoading=!0,this.$http.get(e).then(o=>{this.cart=o.data.data,this.isLoading=!1})},delCart(e){const o=`https://vue3-course-api.hexschool.io/api/roger8426-api/cart/${e}`;this.$http.delete(o).then(n=>{n.data.success&&this.getCart()})},updateCart(e){this.numLoading=!0;const o=`https://vue3-course-api.hexschool.io/api/roger8426-api/cart/${e.id}`,n={product_id:e.product_id,qty:e.qty};this.$http.put(o,{data:n}).then(m=>{m.data.success&&this.getCart(),this.numLoading=!1})},routePush(e){this.$router.push(`/user/product/${e}`)},addCoupon(){const e="https://vue3-course-api.hexschool.io/api/roger8426-api/coupon",o={code:this.couponCode};this.$http.post(e,{data:o}).then(n=>{n.data.success&&(this.couponCode="",this.getCart())})},openCheckModal(){this.$refs.checkModal.showModal()}},created(){this.getCart()}},Y={key:0,class:"container px-0 cart"},Z={class:"table align-middle mt-6"},tt=t("thead",null,[t("tr",null,[t("th",{scope:"col",class:"col-1"}),t("th",{scope:"col",class:"col-1"}),t("th",{scope:"col",class:"col-3 ps-5"},"品名"),t("th",{scope:"col",class:"col-2"},"數量"),t("th",{scope:"col",class:"col-2"},"單價")])],-1),ot={scope:"row",class:"text-center"},st=["onClick"],et=t("i",{class:"bi bi-x"},null,-1),lt=[et],at={class:"p-0"},nt=["onClick"],rt=["src"],dt={class:"ps-5"},ct=["onClick"],it={class:"input-group input-group-sm"},ut=["onUpdate:modelValue","disabled","onChange"],pt=t("div",{class:"input-group-text"},"/ 單位",-1),ht={class:"row mb-6"},mt={class:"col-6 d-flex justify-content-between"},_t={class:"input-group input-group-sm w-50"},ft={class:"input-group-append"},bt={class:"col-3"},gt={class:"pt-2 d-flex justify-content-end"},$t={class:"fw-bold"},vt={key:0,class:"ms-3 fw-bold text-success"},yt={class:"col-3"},Ct={key:1,class:"container px-0 mt-6 mb-6 non-cart text-center"},kt=t("button",{class:"btn btn-outline-primary",type:"buton"}," 您的購物清單目前為空，趕快去商場看看吧！ ",-1);function xt(e,o,n,m,s,r){const l=_("LoadingView"),v=_("router-link"),y=_("CheckModal");return d(),c(b,null,[f(l,{active:s.isLoading},null,8,["active"]),s.cart.total?(d(),c("div",Y,[t("table",Z,[tt,t("tbody",null,[(d(!0),c(b,null,$(s.cart.carts,a=>(d(),c("tr",{key:a.id},[t("th",ot,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:h=>r.delCart(a.id)},lt,8,st)]),t("td",at,[t("a",{href:"#",onclick:"return false",onClick:h=>r.routePush(a.product_id)},[t("img",{class:"w-100",src:a.product.imageUrl,alt:""},null,8,rt)],8,nt)]),t("td",dt,[t("a",{href:"#",onclick:"return false",class:"text-dark",onClick:h=>r.routePush(a.product.title)},i(a.product.title),9,ct)]),t("td",null,[t("div",it,[u(t("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":h=>a.qty=h,disabled:s.numLoading,onChange:h=>r.updateCart(a)},null,40,ut),[[p,a.qty]]),pt])]),t("td",null,i(`NT$ ${e.$filters.currency(a.total)}`),1)]))),128))])]),t("div",ht,[t("div",mt,[t("div",_t,[u(t("input",{type:"text",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":o[0]||(o[0]=a=>s.couponCode=a)},null,512),[[p,s.couponCode]]),t("div",ft,[t("button",{class:"btn btn-outline-primary",type:"button",onClick:o[1]||(o[1]=(...a)=>r.addCoupon&&r.addCoupon(...a))}," 套用優惠碼 ")])])]),t("div",bt,[t("div",gt,[t("div",$t,i(`總價 ${e.$filters.currency(s.cart.total)}`),1),s.cart.total!==s.cart.final_total?(d(),c("div",vt,i(`折扣價 ${e.$filters.currency(s.cart.final_total)}`),1)):x("",!0)])]),t("div",yt,[t("button",{class:"btn btn-primary",type:"button",onClick:o[2]||(o[2]=a=>r.openCheckModal())}," 確認訂單 ")])])])):(d(),c("div",Ct,[f(v,{to:"/user/products"},{default:w(()=>[kt]),_:1})])),f(y,{ref:"checkModal",order:s.cart},null,8,["order"])],64)}const Vt=g(X,[["render",xt]]);export{Vt as default};
