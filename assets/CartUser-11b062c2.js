import{M as w}from"./modal-485b5c39.js";import{_ as $,r as b,o as n,c as r,a as t,b as d,w as x,F as v,d as y,t as u,n as p,i as k,v as C,g as V,f as h}from"./index-6f559ba4.js";import"./component-functions-b2e40170.js";const M={name:"checkModal",props:["order"],data(){return{modal:{},form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{showModal(){this.modal.show()},hideModal(){this.modal.hide()},createOrder(){const l="https://vue3-course-api.hexschool.io/api/roger8426-api/order",e=this.form;this.$http.post(l,{data:e}).then(i=>{i.data.success&&(this.$router.push(`/user/order/${i.data.orderId}`),this.hideModal())})},isPhone(l){return/^(09)[0-9]{8}$/.test(l)?!0:"需要正確的電話號碼"}},mounted(){this.modal=new w(this.$refs.modal)}},L={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},U={class:"modal-dialog",role:"document"},q={class:"modal-content"},N=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},"訂單列表"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),P={class:"modal-body pb-0"},O={class:"row justify-content-center"},S={class:"table align-middle"},j=t("thead",null,[t("th",{class:"ps-2"},"品名"),t("th",null,"數量"),t("th",{class:"text-end pe-2"},"單價")],-1),B={class:"text-end"},E=t("td",{colspan:"2",class:"text-end"},"總計",-1),T={class:"text-end"},D={class:"mb-3"},F=t("label",{for:"email",class:"form-label"},"Email",-1),z={class:"mb-3"},I=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),A={class:"mb-3"},G=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),H={class:"mb-3"},J=t("label",{for:"address",class:"form-label"},"收件人地址",-1),K={class:"mb-3"},Q=t("label",{for:"message",class:"form-label"},"留言",-1),R=t("div",{class:"modal-footer border-top-0 pt-0"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消"),t("button",{class:"btn btn-primary"},"送出訂單")],-1);function W(l,e,i,f,o,c){const _=b("v-field"),m=b("error-message"),g=b("v-form");return n(),r("div",L,[t("div",U,[t("div",q,[N,t("div",P,[t("div",O,[d(g,{class:"col",onSubmit:V(c.createOrder,["prevent"])},{default:x(({errors:s})=>[t("table",S,[j,t("tbody",null,[(n(!0),r(v,null,y(i.order.carts,a=>(n(),r("tr",{key:a.id},[t("td",null,u(a.product.title),1),t("td",null,u(`${a.qty} / ${a.product.unit}`),1),t("td",B,u(l.$filters.currency(a.product.price)),1)]))),128))]),t("tfoot",null,[t("tr",null,[E,t("td",T,u(l.$filters.currency(i.order.final_total)),1)])])]),t("div",D,[F,d(_,{id:"email",name:"email",type:"email",class:p(["form-control",{"is-invalid":s.email}]),placeholder:"請輸入 Email",modelValue:o.form.user.email,"onUpdate:modelValue":e[0]||(e[0]=a=>o.form.user.email=a),rules:"email|required"},null,8,["modelValue","class"]),d(m,{name:"email",class:"invalid-feedback"})]),t("div",z,[I,d(_,{id:"name",name:"姓名",type:"text",class:p(["form-control",{"is-invalid":s.姓名}]),placeholder:"請輸入姓名",modelValue:o.form.user.name,"onUpdate:modelValue":e[1]||(e[1]=a=>o.form.user.name=a),rules:"required"},null,8,["modelValue","class"]),d(m,{name:"姓名",class:"invalid-feedback"})]),t("div",A,[G,d(_,{id:"tel",name:"電話",type:"tel",class:p(["form-control",{"is-invalid":s.電話}]),placeholder:"請輸入電話",modelValue:o.form.user.tel,"onUpdate:modelValue":e[2]||(e[2]=a=>o.form.user.tel=a),rules:c.isPhone},null,8,["modelValue","class","rules"]),d(m,{name:"電話",class:"invalid-feedback"})]),t("div",H,[J,d(_,{id:"address",name:"地址",type:"text",class:p(["form-control",{"is-invalid":s.地址}]),placeholder:"請輸入地址",modelValue:o.form.user.address,"onUpdate:modelValue":e[3]||(e[3]=a=>o.form.user.address=a),rules:"required"},null,8,["modelValue","class"]),d(m,{name:"地址",class:"invalid-feedback"})]),t("div",K,[Q,k(t("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":e[4]||(e[4]=a=>o.form.message=a)},null,512),[[C,o.form.message]])]),R]),_:1},8,["onSubmit"])])])])])],512)}const X=$(M,[["render",W]]),Y={data(){return{cart:{},orders:{},total:0,finalTotal:0,tempProduct:{},isLoading:!1,numLoading:!1,couponCode:"",tabCheck:"購物車"}},components:{CheckModal:X},inject:["emitter"],methods:{getCart(){const l="https://vue3-course-api.hexschool.io/api/roger8426-api/cart";this.isLoading=!0,this.$http.get(l).then(e=>{this.cart=e.data.data,this.isLoading=!1})},getOrders(){const l="https://vue3-course-api.hexschool.io/api/roger8426-api/orders";this.isLoading=!0,this.$http.get(l,this.tempProduct).then(e=>{this.orders=e.data.orders,this.isLoading=!1,console.log(this.orders)})},delCart(l){let e=`https://vue3-course-api.hexschool.io/api/roger8426-api/cart/${l}`;this.$http.delete(e).then(i=>{i.data.success&&(e="https://vue3-course-api.hexschool.io/api/roger8426-api/cart",this.$http.get(e).then(f=>{this.cartNum=f.data.data.carts.length,this.emitter.emit("cart-num",this.cartNum),this.getCart()}))})},updateCart(l){this.numLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/roger8426-api/cart/${l.id}`,i={product_id:l.product_id,qty:l.qty};this.$http.put(e,{data:i}).then(f=>{f.data.success&&this.getCart(),this.numLoading=!1})},routePush(l){this.$router.push(`/user/product/${l}`)},addCoupon(){const l="https://vue3-course-api.hexschool.io/api/roger8426-api/coupon",e={code:this.couponCode};this.$http.post(l,{data:e}).then(i=>{i.data.success&&(this.couponCode="",this.getCart())})},openCheckModal(){this.$refs.checkModal.showModal()},tabSwitch(l){this.tabCheck=l.target.innerText},checkOrder(l){this.$router.push(`/user/order/${l}`)}},created(){this.getCart(),this.getOrders()}},Z={class:"container"},tt={key:0,class:"container px-0 cart"},et={key:0},st={class:"table align-middle"},ot=t("thead",null,[t("tr",null,[t("th",{scope:"col",class:"col-1"}),t("th",{scope:"col",class:"col-1"}),t("th",{scope:"col",class:"col-3 ps-5"},"品名"),t("th",{scope:"col",class:"col-2"},"數量"),t("th",{scope:"col",class:"col-2"},"單價")])],-1),lt={scope:"row",class:"text-center"},at=["onClick"],nt=t("i",{class:"bi bi-x"},null,-1),rt=[nt],ct={class:"p-0"},it=["onClick"],dt=["src"],ut={class:"ps-5"},ht=["onClick"],pt={class:"input-group input-group-sm"},_t=["onUpdate:modelValue","disabled","onChange"],mt=t("div",{class:"input-group-text"},"/ 單位",-1),bt={class:"row mb-6"},ft={class:"col-6 d-flex justify-content-between"},vt={class:"input-group input-group-sm w-50"},gt={class:"input-group-append"},yt={class:"col-3"},kt={class:"pt-2 d-flex justify-content-end"},Ct={class:"fw-bold"},$t={key:0,class:"ms-3 fw-bold text-success"},xt={class:"col-3"},wt={key:1,class:"container px-0 mb-6"},Vt={class:"container px-0"},Mt={class:"table mt-4"},Lt=t("thead",null,[t("tr",null,[t("th",null,"下單時間"),t("th",null,"Email"),t("th",null,"訂單編號"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),Ut={class:"pb-0"},qt={class:"pb-0"},Nt=["textContent"],Pt={class:"pb-0"},Ot={class:"text-right pb-0"},St={class:"pb-0"},jt={key:0,class:"text-success"},Bt={key:1,class:"text-danger"},Et={class:"btn-group"},Tt=["onClick"],Dt={key:2,class:"container px-0 mt-6 mb-6 non-cart text-center"},Ft=t("button",{class:"btn btn-outline-primary",type:"buton"}," 您的購物清單目前為空，趕快去商場看看吧！ ",-1);function zt(l,e,i,f,o,c){const _=b("LoadingView"),m=b("router-link"),g=b("CheckModal");return n(),r(v,null,[d(_,{active:o.isLoading},null,8,["active"]),t("div",Z,[t("div",{class:"px-0 btn-group mt-6",role:"group","aria-label":"Basic example",onClick:e[0]||(e[0]=(...s)=>c.tabSwitch&&c.tabSwitch(...s))},[t("button",{type:"button",class:p(["btn btn-outline-primary",{active:o.tabCheck==="購物車"}])},"購物車",2),t("button",{type:"button",class:p(["btn btn-outline-primary",{active:o.tabCheck==="訂單列表"}])},"訂單列表",2)])]),o.cart.total?(n(),r("div",tt,[o.tabCheck==="購物車"?(n(),r("div",et,[t("table",st,[ot,t("tbody",null,[(n(!0),r(v,null,y(o.cart.carts,s=>(n(),r("tr",{key:s.id},[t("th",lt,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:a=>c.delCart(s.id)},rt,8,at)]),t("td",ct,[t("a",{href:"#",onclick:"return false",onClick:a=>c.routePush(s.product_id)},[t("img",{class:"w-100",src:s.product.imageUrl,alt:""},null,8,dt)],8,it)]),t("td",ut,[t("a",{href:"#",onclick:"return false",class:"text-dark",onClick:a=>c.routePush(s.product.title)},u(s.product.title),9,ht)]),t("td",null,[t("div",pt,[k(t("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":a=>s.qty=a,disabled:o.numLoading,onChange:a=>c.updateCart(s)},null,40,_t),[[C,s.qty]]),mt])]),t("td",null,u(`NT$ ${l.$filters.currency(s.total)}`),1)]))),128))])]),t("div",bt,[t("div",ft,[t("div",vt,[k(t("input",{type:"text",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":e[1]||(e[1]=s=>o.couponCode=s)},null,512),[[C,o.couponCode]]),t("div",gt,[t("button",{class:"btn btn-outline-primary",type:"button",onClick:e[2]||(e[2]=(...s)=>c.addCoupon&&c.addCoupon(...s))}," 套用優惠碼 ")])])]),t("div",yt,[t("div",kt,[t("div",Ct,u(`總價 ${l.$filters.currency(o.cart.total)}`),1),o.cart.total!==o.cart.final_total?(n(),r("div",$t,u(`折扣價 ${l.$filters.currency(o.cart.final_total)}`),1)):h("",!0)])]),t("div",xt,[t("button",{class:"btn btn-primary",type:"button",onClick:e[3]||(e[3]=s=>c.openCheckModal())}," 確認訂單 ")])])])):h("",!0)])):h("",!0),o.tabCheck==="訂單列表"?(n(),r("div",wt,[t("div",Vt,[t("table",Mt,[Lt,t("tbody",null,[(n(!0),r(v,null,y(o.orders,(s,a)=>(n(),r(v,{key:a},[o.orders.length?(n(),r("tr",{key:0,class:p({"text-secondary":!s.is_paid})},[t("td",Ut,u(l.$filters.date(s.create_at)),1),t("td",qt,[s.user?(n(),r("span",{key:0,textContent:u(s.user.email)},null,8,Nt)):h("",!0)]),t("td",Pt,u(s.id),1),t("td",Ot,u(s.total),1),t("td",St,[s.is_paid?(n(),r("span",jt,"已付款")):(n(),r("span",Bt,"未付款"))]),t("td",null,[t("div",Et,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:It=>c.checkOrder(s.id)},"檢視訂單",8,Tt)])])],2)):h("",!0)],64))),128))])])])])):h("",!0),!o.cart.total&&o.tabCheck==="購物車"?(n(),r("div",Dt,[d(m,{to:"/user/products"},{default:x(()=>[Ft]),_:1})])):h("",!0),d(g,{ref:"checkModal",order:o.cart},null,8,["order"])],64)}const Jt=$(Y,[["render",zt]]);export{Jt as default};
