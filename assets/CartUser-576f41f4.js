import{M as w}from"./modal-195e646f.js";import{_ as x,r as b,o as n,c as r,d as t,e as i,w as $,F as v,g as k,t as u,n as h,k as y,v as C,j as V,f as p}from"./index-e3b22acb.js";import"./component-functions-848d0fd3.js";const M={name:"checkModal",props:["order"],data(){return{modal:{},form:{user:{name:"",email:"",tel:"",address:""},message:""}}},methods:{showModal(){this.modal.show()},hideModal(){this.modal.hide()},createOrder(){const l="https://vue3-course-api.hexschool.io/api/roger8426-api/order",e=this.form;this.$http.post(l,{data:e}).then(d=>{d.data.success&&(this.$router.push(`/user/order/${d.data.orderId}`),this.hideModal())})},isPhone(l){return/^(09)[0-9]{8}$/.test(l)?!0:"需要正確的電話號碼"}},mounted(){this.modal=new w(this.$refs.modal)}},L={class:"modal fade",id:"couponModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"modal"},U={class:"modal-dialog",role:"document"},q={class:"modal-content"},N=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"exampleModalLabel"},"訂單列表"),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),P={class:"modal-body pb-0"},O={class:"row justify-content-center"},S={class:"table align-middle"},j=t("thead",null,[t("th",{class:"ps-2"},"品名"),t("th",null,"數量"),t("th",{class:"text-end pe-2"},"單價")],-1),B={class:"text-end"},E=t("td",{colspan:"2",class:"text-end"},"總計",-1),T={class:"text-end"},D={class:"mb-3"},F=t("label",{for:"email",class:"form-label"},"Email",-1),z={class:"mb-3"},I=t("label",{for:"name",class:"form-label"},"收件人姓名",-1),A={class:"mb-3"},G=t("label",{for:"tel",class:"form-label"},"收件人電話",-1),H={class:"mb-3"},J=t("label",{for:"address",class:"form-label"},"收件人地址",-1),K={class:"mb-3"},Q=t("label",{for:"message",class:"form-label"},"留言",-1),R=t("div",{class:"modal-footer border-top-0 pt-0"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"取消"),t("button",{class:"btn btn-primary"},"送出訂單")],-1);function W(l,e,d,f,s,c){const m=b("v-field"),_=b("error-message"),g=b("v-form");return n(),r("div",L,[t("div",U,[t("div",q,[N,t("div",P,[t("div",O,[i(g,{class:"col",onSubmit:V(c.createOrder,["prevent"])},{default:$(({errors:o})=>[t("table",S,[j,t("tbody",null,[(n(!0),r(v,null,k(d.order.carts,a=>(n(),r("tr",{key:a.id},[t("td",null,u(a.product.title),1),t("td",null,u(`${a.qty} / ${a.product.unit}`),1),t("td",B,u(l.$filters.currency(a.product.price)),1)]))),128))]),t("tfoot",null,[t("tr",null,[E,t("td",T,u(l.$filters.currency(d.order.final_total)),1)])])]),t("div",D,[F,i(m,{id:"email",name:"email",type:"email",class:h(["form-control",{"is-invalid":o.email}]),placeholder:"請輸入 Email",modelValue:s.form.user.email,"onUpdate:modelValue":e[0]||(e[0]=a=>s.form.user.email=a),rules:"email|required"},null,8,["modelValue","class"]),i(_,{name:"email",class:"invalid-feedback"})]),t("div",z,[I,i(m,{id:"name",name:"姓名",type:"text",class:h(["form-control",{"is-invalid":o.姓名}]),placeholder:"請輸入姓名",modelValue:s.form.user.name,"onUpdate:modelValue":e[1]||(e[1]=a=>s.form.user.name=a),rules:"required"},null,8,["modelValue","class"]),i(_,{name:"姓名",class:"invalid-feedback"})]),t("div",A,[G,i(m,{id:"tel",name:"電話",type:"tel",class:h(["form-control",{"is-invalid":o.電話}]),placeholder:"請輸入電話",modelValue:s.form.user.tel,"onUpdate:modelValue":e[2]||(e[2]=a=>s.form.user.tel=a),rules:c.isPhone},null,8,["modelValue","class","rules"]),i(_,{name:"電話",class:"invalid-feedback"})]),t("div",H,[J,i(m,{id:"address",name:"地址",type:"text",class:h(["form-control",{"is-invalid":o.地址}]),placeholder:"請輸入地址",modelValue:s.form.user.address,"onUpdate:modelValue":e[3]||(e[3]=a=>s.form.user.address=a),rules:"required"},null,8,["modelValue","class"]),i(_,{name:"地址",class:"invalid-feedback"})]),t("div",K,[Q,y(t("textarea",{name:"",id:"message",class:"form-control",cols:"30",rows:"10","onUpdate:modelValue":e[4]||(e[4]=a=>s.form.message=a)},null,512),[[C,s.form.message]])]),R]),_:1},8,["onSubmit"])])])])])],512)}const X=x(M,[["render",W]]),Y={data(){return{cart:{},orders:{},total:0,finalTotal:0,tempProduct:{},isLoading:!1,numLoading:!1,couponCode:"",tabCheck:"購物車"}},components:{CheckModal:X},inject:["emitter"],methods:{getCart(){const l="https://vue3-course-api.hexschool.io/api/roger8426-api/cart";this.isLoading=!0,this.$http.get(l).then(e=>{this.cart=e.data.data,this.isLoading=!1})},getOrders(){const l="https://vue3-course-api.hexschool.io/api/roger8426-api/orders";this.isLoading=!0,this.$http.get(l,this.tempProduct).then(e=>{this.orders=e.data.orders,this.isLoading=!1})},delCart(l){let e=`https://vue3-course-api.hexschool.io/api/roger8426-api/cart/${l}`;this.$http.delete(e).then(d=>{d.data.success&&(e="https://vue3-course-api.hexschool.io/api/roger8426-api/cart",this.$http.get(e).then(f=>{this.cartNum=f.data.data.carts.length,this.emitter.emit("cart-num",this.cartNum),this.getCart()}))})},updateCart(l){this.numLoading=!0;const e=`https://vue3-course-api.hexschool.io/api/roger8426-api/cart/${l.id}`,d={product_id:l.product_id,qty:l.qty};this.$http.put(e,{data:d}).then(f=>{f.data.success&&this.getCart(),this.numLoading=!1})},routePush(l){this.$router.push(`/user/product/${l}`)},addCoupon(){const l="https://vue3-course-api.hexschool.io/api/roger8426-api/coupon",e={code:this.couponCode};this.$http.post(l,{data:e}).then(d=>{d.data.success?(this.couponCode="",this.getCart()):alert(d.data.message)})},openCheckModal(){this.$refs.checkModal.showModal()},tabSwitch(l){this.tabCheck=l.target.innerText},checkOrder(l){this.$router.push(`/user/order/${l}`)}},created(){this.getCart(),this.getOrders()}},Z={class:"container-xl"},tt={key:0,class:"container-xl cart"},et={key:0},st={class:"table align-middle"},ot=t("thead",null,[t("tr",null,[t("th",{scope:"col",class:"col-1"}),t("th",{scope:"col",class:"col-1 d-sm-none d-md-table-cell"}),t("th",{scope:"col",class:"col-3 ps-5"},"品名"),t("th",{scope:"col",class:"col-2"},"數量"),t("th",{scope:"col",class:"col-2"},"單價")])],-1),lt={scope:"row",class:"text-center"},at=["onClick"],nt=t("i",{class:"bi bi-x"},null,-1),rt=[nt],dt={class:"p-0 d-sm-none d-md-block"},ct=["onClick"],it=["src"],ut={class:"ps-md-5"},ht=["onClick"],pt={class:"input-group input-group-sm"},mt=["onUpdate:modelValue","disabled","onChange"],_t=t("div",{class:"input-group-text"},"/ 單位",-1),bt={class:"row mb-6"},ft={class:"col-sm-6 col-md-4 d-flex justify-content-between"},vt={class:"input-group input-group-sm w-100"},gt={class:"input-group-append"},kt={class:"col-sm-6 col-md-5"},yt={class:"pt-2 d-flex justify-content-end"},Ct={class:"fw-bold"},xt={key:0,class:"ms-3 fw-bold text-success"},$t={class:"col-md-3 d-sm-block mt-sm-4 mt-md-0 text-sm-end text-md-start"},wt={key:1,class:"container mb-6"},Vt={class:"container px-0"},Mt={class:"table mt-4"},Lt=t("thead",null,[t("tr",null,[t("th",null,"下單時間"),t("th",null,"Email"),t("th",null,"訂單編號"),t("th",null,"應付金額"),t("th",null,"是否付款"),t("th",null,"編輯")])],-1),Ut={class:"pb-0"},qt={class:"pb-0"},Nt=["textContent"],Pt={class:"pb-0"},Ot={class:"text-right pb-0"},St={class:"pb-0"},jt={key:0,class:"text-success"},Bt={key:1,class:"text-danger"},Et={class:"btn-group"},Tt=["onClick"],Dt={key:2,class:"container px-0 mt-6 mb-6 non-cart text-center"},Ft=t("button",{class:"btn btn-outline-primary",type:"buton"}," 您的購物清單目前為空，趕快去商場看看吧！ ",-1);function zt(l,e,d,f,s,c){const m=b("LoadingView"),_=b("router-link"),g=b("CheckModal");return n(),r(v,null,[i(m,{active:s.isLoading},null,8,["active"]),t("div",Z,[t("div",{class:"px-0 btn-group mt-6",role:"group","aria-label":"Basic example",onClick:e[0]||(e[0]=(...o)=>c.tabSwitch&&c.tabSwitch(...o))},[t("button",{type:"button",class:h(["btn btn-outline-primary",{active:s.tabCheck==="購物車"}])},"購物車",2),t("button",{type:"button",class:h(["btn btn-outline-primary",{active:s.tabCheck==="訂單列表"}])},"訂單列表",2)])]),s.cart.total?(n(),r("div",tt,[s.tabCheck==="購物車"?(n(),r("div",et,[t("table",st,[ot,t("tbody",null,[(n(!0),r(v,null,k(s.cart.carts,o=>(n(),r("tr",{key:o.id},[t("th",lt,[t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:a=>c.delCart(o.id)},rt,8,at)]),t("td",dt,[t("a",{href:"#",onclick:"return false",onClick:a=>c.routePush(o.product_id)},[t("img",{class:"w-100",src:o.product.imageUrl,alt:""},null,8,it)],8,ct)]),t("td",ut,[t("a",{href:"#",onclick:"return false",class:"text-dark",onClick:a=>c.routePush(o.product_id)},u(o.product.title),9,ht)]),t("td",null,[t("div",pt,[y(t("input",{type:"number",class:"form-control",min:"1","onUpdate:modelValue":a=>o.qty=a,disabled:s.numLoading,onChange:a=>c.updateCart(o),oninput:"this.value=this.value.replace(/[^0-9.]+/g,'');"},null,40,mt),[[C,o.qty]]),_t])]),t("td",null,u(`NT$ ${l.$filters.currency(o.total)}`),1)]))),128))])]),t("div",bt,[t("div",ft,[t("div",vt,[y(t("input",{type:"text",class:"form-control",placeholder:"請輸入優惠碼","onUpdate:modelValue":e[1]||(e[1]=o=>s.couponCode=o)},null,512),[[C,s.couponCode]]),t("div",gt,[t("button",{class:h(["btn btn-outline-primary rounded-start-0",{disabled:!s.couponCode}]),type:"button",onClick:e[2]||(e[2]=(...o)=>c.addCoupon&&c.addCoupon(...o))}," 套用優惠碼 ",2)])])]),t("div",kt,[t("div",yt,[t("div",Ct,u(`總價 ${l.$filters.currency(s.cart.total)}`),1),s.cart.total!==s.cart.final_total?(n(),r("div",xt,u(`折扣價 ${l.$filters.currency(s.cart.final_total)}`),1)):p("",!0)])]),t("div",$t,[t("button",{class:"btn btn-primary",type:"button",onClick:e[3]||(e[3]=o=>c.openCheckModal())}," 確認訂單 ")])])])):p("",!0)])):p("",!0),s.tabCheck==="訂單列表"?(n(),r("div",wt,[t("div",Vt,[t("table",Mt,[Lt,t("tbody",null,[(n(!0),r(v,null,k(s.orders,(o,a)=>(n(),r(v,{key:a},[s.orders.length?(n(),r("tr",{key:0,class:h({"text-secondary":!o.is_paid})},[t("td",Ut,u(l.$filters.date(o.create_at)),1),t("td",qt,[o.user?(n(),r("span",{key:0,textContent:u(o.user.email)},null,8,Nt)):p("",!0)]),t("td",Pt,u(o.id),1),t("td",Ot,u(o.total),1),t("td",St,[o.is_paid?(n(),r("span",jt,"已付款")):(n(),r("span",Bt,"未付款"))]),t("td",null,[t("div",Et,[t("button",{class:"btn btn-outline-primary btn-sm",onClick:It=>c.checkOrder(o.id)},"檢視訂單",8,Tt)])])],2)):p("",!0)],64))),128))])])])])):p("",!0),!s.cart.total&&s.tabCheck==="購物車"?(n(),r("div",Dt,[i(_,{to:"/user/products"},{default:$(()=>[Ft]),_:1})])):p("",!0),i(g,{ref:"checkModal",order:s.cart},null,8,["order"])],64)}const Jt=x(Y,[["render",zt]]);export{Jt as default};
